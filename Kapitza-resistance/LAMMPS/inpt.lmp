# @author: Sobin Alosious
# @description: LAMMPS file to output
# 1) temperature difference between wall and slab
# 2) heatfllux at the interface
##################################################

echo		screen
units		real
atom_style	full
boundary	p p p

############### VARIABLES ########################

#1ns= 1e6
variable	dfreq equal 1			
variable	equrun1 equal 2e2
variable	equrun2 equal 2e2
variable	prorun equal  5e2

variable	seed equal ${irun}*56096
variable 	Tequil equal 300

############### INPUT ############################

read_data	waterCnt.lmpsys

############### GROUPING #########################


group 		water type 1 2 
group		hyd type 1
group 		cnt type 3 


############### POTENTIALS #######################

#type 1 :hydrogen
#type 2 :oxygen
#type 3-22 :carbon


pair_style      hybrid tersoff lj/cut/coul/long 10.0 10.0
kspace_style 	pppm 0.00001
#kspace_modify	slab 3.0
bond_style   	harmonic
angle_style  	harmonic
pair_modify  	mix arithmetic shift yes

bond_coeff   	1 1000.0 1.0 
angle_coeff  	1 1000.0 109.47

pair_coeff	* * tersoff include/SiC.tersoff_real_opt NULL NULL C     # C-C:TERSOFF (https://doi.org/10.1103/PhysRevB.81.205441)

pair_coeff   	1 1 lj/cut/coul/long 0.0 0.0	     			# H-H           
pair_coeff   	1 2 lj/cut/coul/long 0.0 0.0		       		# H-O        
pair_coeff      2 2 lj/cut/coul/long 0.1554 3.165	        	# O-O  (https://doi.org/10.1063/1.2136877)     
pair_coeff   	1 3* lj/cut/coul/long 0.0 0.0	                	# H-C*
pair_coeff   	2 3* lj/cut/coul/long 0.0937 3.19  			# O-C* (https://doi.org/10.1021/jp0268112) 
             


############### INITIALIZATION ###################

timestep	1
neighbor	2 bin
neigh_modify    every 1 delay 0 check yes 
neigh_modify    exclude group hyd cnt
velocity	water create ${Tequil} ${seed} mom yes rot yes dist gaussian
velocity	cnt create ${Tequil} ${seed} mom yes rot yes dist gaussian


############### COMPUTING ########################

compute		tempW water temp
compute		tempcnt cnt temp



############### MINIMIZATION ######################

fix		fxcnt cnt setforce 0.0 0.0 0.0
minimize 	1.0e-2 1.0e-2 100000 100000
unfix		fxcnt
reset_timestep  0

################## FIXES ##########################

fix 		fxshk water shake 0.0001 20 0 b 1 a 1
fix             fxmom cnt momentum 1 linear 1 1 1 

################## EQUILIBRATION-1 #################

fix		fxnveall1 all nve
fix 		fxnvtcnt1 cnt langevin ${Tequil} ${Tequil} $(100.0*dt) 67883 tally yes
fix 		fxnvtwater1 water langevin ${Tequil} ${Tequil} $(100.0*dt) 67883 tally yes
fix_modify      fxnvtcnt1 temp tempcnt
fix_modify      fxnvtwater1 temp tempW
thermo_style    custom step c_tempcnt c_tempW  pe ke etotal
thermo          1000
run 		${equrun1}
unfix		fxnveall1
unfix		fxnvtcnt1
unfix 		fxnvtwater1
reset_timestep  0

################## EQUILIBRATION-2 #################


fix		fxnveall3 all nve
fix 		fxnvtcnt3 cnt langevin ${Tequil} ${Tequil} $(100.0*dt) 67883 tally yes
fix_modify      fxnvtcnt3 temp tempcnt

thermo_style    custom step c_tempcnt c_tempW  pe ke etotal
thermo          1000
run 		${equrun2}
unfix		fxnveall3
unfix		fxnvtcnt3

reset_timestep  0

################## PRODUCTION ######################

fix		fxnveallP all nve
fix 		fxnvtcntP cnt langevin ${Tequil} ${Tequil} $(100.0*dt) 67883 tally yes

fix_modify      fxnvtcntP temp tempcnt

################## TEMPERATURE DROP #################

#radius=20.3
#delta=3.165
#annular region= 20.3-3.165= 17.135 (17.135^2 = 293.6) 

variable 	myregion atom "x^2+y^2 > 293.6 "   
group 		slab dynamic water var myregion every 1



compute 	slabtemp slab temp
variable	vslabtemp equal c_slabtemp

compute         cnttemp cnt temp
variable	vcnttemp equal c_cnttemp
variable	tempdeltafinal equal v_vslabtemp-v_vcnttemp


################## HEAT FLUX ######################


compute		Lvelx cnt property/atom vx
compute 	forceLx cnt force/tally slab
compute		Lvely cnt property/atom vy
compute 	forceLy cnt force/tally slab
compute		Lvelz cnt property/atom vz
compute 	forceLz cnt force/tally slab
variable	heatL atom c_Lvelx*c_forceLx[1]+c_Lvely*c_forceLy[2]+c_Lvelz*c_forceLz[3]
compute         aveheatleft cnt reduce sum v_heatL
variable	fluxleft equal c_aveheatleft
fix		fxfluxleft cnt print ${dfreq} "${fluxleft}" file fluxcnt.${irun}.dat screen no


################## TEMPERATURE DROP #################


compute 	slabtempf water temp
variable	vslabtempf equal c_slabtempf


variable	tempdeltafinalf equal v_vslabtempf-v_vcnttemp

fix		Tempf all print ${dfreq} "${tempdeltafinalf}"  file tempdropdelta_fluid.${irun}.dat screen no


fix		Temp all print ${dfreq} "${tempdeltafinal} ${vcnttemp} ${vslabtemp} ${vslabtempf}"  file tempdropdelta.${irun}.dat screen no

################## HEAT FLUX ######################


compute		Lvelxf cnt property/atom vx
compute 	forceLxf cnt force/tally water
compute		Lvelyf cnt property/atom vy
compute 	forceLyf cnt force/tally water
compute		Lvelzf cnt property/atom vz
compute 	forceLzf cnt force/tally water
variable	heatLf atom c_Lvelxf*c_forceLxf[1]+c_Lvelyf*c_forceLyf[2]+c_Lvelzf*c_forceLzf[3]
compute         aveheatleftf cnt reduce sum v_heatLf
variable	fluxleftf equal c_aveheatleftf
fix		fxfluxleftf cnt print ${dfreq} "${fluxleftf}" file fluxcnt_fluid.${irun}.dat screen no


###################################################

thermo_style    custom step c_tempcnt c_tempW  pe ke etotal
thermo          1000
run 		${prorun}

###################################################
